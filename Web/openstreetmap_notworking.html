<!DOCTYPE html>
<html lang="de">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
      <title>HowTo: Mini-Beispiel "Leaflet Karte mit Marker"</title>
      <!-- leaflet.css und leaflet.js von externer Quelle einbinden -->
        <!--Einbindung für Pc-->
        
		<link rel="stylesheet" href="/Web/leaflet/leaflet.css" />
		<script src="/Web/leaflet/leaflet.js"></script>
        
        <!--Einbindung fürs Handy-->
		
		<link rel="stylesheet" href="../leaflet/leaflet.css" />
		<script src="../leaflet/leaflet.js"></script>
		
   </head>
   <body>
	   	<header>
               <p>Eigenkreation mit leaflet</p>
            <button id="los" style="width: 44.8%; height: 30px;">show</button>
            <button id="go" style="width: 44.8%; height: 30px;">game start</button>
		</header>
		<div id='meineKarte' style='height: 670px; width: 90%;'></div>
		<!-- OSM-Basiskarte einfügen und zentrieren -->
		<script type='text/javascript'>
			var lon = 48.54;
			var lat = 10.96;

			var Karte = L.map('meineKarte').setView([lon, lat], 14);
			L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			'attribution':  'Kartendaten &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> Mitwirkende',
			'useCache': true
			}).addTo(Karte);
		
		</script>
		<script>
			//Event Start function positionnow
			var button =document.getElementById('los'); 
            button.addEventListener ('click', positionnow);

            //Event Start function Game_Start
			var button =document.getElementById('go'); 
            button.addEventListener ('click', game_start);
					
			function positionnow() {
				//Positionsermittlung
				if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showposition);
                } else { 
                    ausgabe.innerHTML = 'Ihr Browser unterstützt keine Geolocation.';
                }

                function showposition(position) {
                    var lange = position.coords.latitude;
                    var breite = position.coords.longitude;
                    var marker = L.marker([lange, breite]).addTo(Karte);
                }
			}

            function game_start() {
                
                //Objekt um die initialisierung nur einmal auszuführen
                var idx = { index:"0"};

                function onPositionReceived(position, index, e) {

                    if(idx.index == "1"){
                        //position in der console ausgeben
                        console.log(position);
                        
                    }else{


                        //Zielort
                        var lat_target = 43.532131;
                        var lon_target = 15.981305;
                        
                        //Aktuelle Position mit Kreis darstellen
                        var circle = L.circle([position.coords.latitude, position.coords.longitude], {
                            color: "white",
                            fillColor: "blue",
                            fillOpacity: 0.5,
                            radius: 3.0
                        }).addTo(Karte);

                        //index die 1 zuweisen damit beim nächsten func aufruf er in den if teil geht 
                        idx.index = "1";
                    }
                }
                function locationNotReceived(positionError){
                    console.log(positionError);
                }

                options = {
                    enableHighAccuracy: true
                    
                }
                if(navigator.geolocation){
                    navigator.geolocation.getCurrentPosition(onPositionReceived, locationNotReceived,{timeout: 1000});

                    var watch = navigator.geolocation.watchPosition(onPositionReceived, locationNotReceived, options);
                }
            } 
    	</script>
  	</body>
</html>
<!--
    //Neuen Zielortmarker erstellen
    var orangeIcon = L.icon({
        iconUrl: 'leaflet/images/leaf-orange.png',
        shadowUrl: 'leaflet/images/leaf-shadow.png',

        iconSize:     [38, 95], // size of the icon
        shadowSize:   [50, 64], // size of the shadow
        iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
        shadowAnchor: [4, 62],  // the same for the shadow
        popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
    });
-->